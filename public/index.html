<h2>Pushy AI test client</h2>
<p>Open multiple clients and observe communication.</p>
<form id="form" onsubmit="return send()">
  <input id="input" type="text" name="input">
  <input type="submit" value="Send">
</form>

<div id="buttons">
  <button id="left">&larr;</button>
  <button id="right">&rarr;</button>
  <button id="up">&uarr;</button>
  <button id="down">&darr;</button>
</div>
<br/>
<div id="messages">Connecting...</div>

<script>
  
const messageEl = document.querySelector('#messages');
const inputEl = document.querySelector('#input');
const leftEl = document.querySelector('#left');
const rightEl = document.querySelector('#right');
const downEl = document.querySelector('#down');
const upEl = document.querySelector('#up');

const wsProtocol = window.location.protocol == "https:" ? "wss" : "ws";
const connection = new WebSocket(`${wsProtocol}://${window.location.hostname}:${window.location.port}`);

connection.onopen = function() {
  messageEl.innerText = 'Websocket connected!';
};
  
connection.onerror = function(e) {
  messageEl.innerText = 'Error';
};
 
connection.onmessage = function(message) {
  const data = JSON.parse(message.data);
  messageEl.innerHTML = '<br/>' + messageEl.innerHTML; 
  if(data.message) { 
    messageEl.prepend('Client ' + data.cid + ': ' + data.message);
  }
  if(data.actions) {
    messageEl.prepend('Client ' + data.cid + ': ' + data.actions);
  }
};

  
function send() {
  if(inputEl.value.trim().length < 1)
    return false;
  const message = { message: inputEl.value };
  connection.send(JSON.stringify(message));
  inputEl.value = '';
  return false;
}
  
leftEl.onclick = () => {
  connection.send(JSON.stringify({ event: 'action', actions: ['LEFT'] }));
}
rightEl.onclick = () => {
  connection.send(JSON.stringify({ event: 'action', actions: ['RIGHT'] }));
}
upEl.onclick = () => {
  connection.send(JSON.stringify({ event: 'action', actions: ['FORWARD'] }));
}
downEl.onclick = () => {
  connection.send(JSON.stringify({ event: 'action', actions: ['REVERSE'] }));
}
  
</script>